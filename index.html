<html>
  <head>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="//cdn.split.io/sdk/split-10.15.9.min.js"></script>
    <style>
      .done {
        text-decoration: line-through;
      }
    </style>
    <title>Sample Todo List</title>
  </head>
  <body>
    <div id="todo-app">
      <ul>
        <todo-item
          v-for="item in state.todoList"
          v-bind:todo="item"
          v-bind:done-enabled="state.doneEnabled"
        ></todo-item>
      </ul>
      <form @submit="addTodo">
        <input type="text" placeholder="Add todo" v-model="newItem" />
        <input type="submit" name="Add" value="Add" />
      </form>
    </div>

    <script>
      const store = {
        state: Vue.reactive({
          todoList: [{ text: 'First task', done: false }],
          doneEnabled: false
        })
      }

      const TodoList = {
        data() {
          return store
        },
        methods: {
          addTodo(event) {
            this.state.todoList.push({ text: this.newItem, isDone: false })
            this.newItem = ''

            event.preventDefault()
            return false
          },

          toggleDoneFeature(value) {
            this.state.doneEnabled = value
          }
        }
      }

      const app = Vue.createApp(TodoList)

      app.component('todo-item', {
        props: ['todo', 'doneEnabled'],
        template: `
          <li v-if="doneEnabled">
            <input type="checkbox" v-model="todo.isDone" />
            <label :class="{ done: todo.isDone}">{{ todo.text }}</label>
          </li>
          <li v-if="!doneEnabled">
            {{ todo.text }}
          </li>
        `
      })

      vm = app.mount('#todo-app')
    </script>
    <script>
      try {
        // Instantiate the SDK. CDN will expose splitio globally
        var factory = splitio({
          core: {
            authorizationKey: 'mqoljmh2jr42cesq1ma3ogsa6fc71dj5h6s2',
            // your internal user id, or the account id that
            // the user belongs to.
            // This coudld also be a cookie you generate
            // for anonymous users
            key: 'me',
          }
        });
        // And get the client instance you'll use
        var client = factory.client();
      } catch (error) {
        console.error(error)
      }

      client.on(client.Event.SDK_READY, function() {
        var treatment = client.getTreatment('SPL-TODO_Done');
        if (treatment === 'on') {
            console.log('on')
            vm.toggleDoneFeature(true)
        } else if (treatment === 'off') {
            console.log('off')
            vm.toggleDoneFeature(false)
        } else {
            console.log(treatment)
        }
      })
    </script>
  </body>
</html>