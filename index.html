<html>
  <head>
    <script>
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="Wj2ggLLlDANz0QdVeCwSrDprGnIGNjej";;analytics.SNIPPET_VERSION="4.15.3";
      analytics.load("Wj2ggLLlDANz0QdVeCwSrDprGnIGNjej");
      analytics.page();
      }}();
    </script>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="//cdn.split.io/sdk/split-10.15.9.min.js"></script>
    <style>
      .done {
        text-decoration: line-through;
      }
    </style>
    <title>Sample Todo List</title>
  </head>
  <body>
    <div id="todo-app">
      <ul>
        <todo-item
          v-for="item in state.todoList"
          v-bind:todo="item"
          v-bind:done-enabled="state.doneEnabled"
          v-on:done-changed="changeDoneState"
        ></todo-item>
      </ul>
      <form @submit="addTodo">
        <input type="text" placeholder="Add todo" v-model="newItem" />
        <input type="submit" name="Add" value="Add" />
      </form>
    </div>

    <script>
      const store = {
        state: Vue.reactive({
          todoList: [{ text: 'First task', done: false }],
          doneEnabled: false
        })
      }

      const TodoList = {
        data() {
          return store
        },
        methods: {
          addTodo(event) {
            this.state.todoList.push({ text: this.newItem, isDone: false })
            this.newItem = ''

            analytics.track('Todo added', {
              totalInCurrentList: this.state.todoList.length
            })

            event.preventDefault()
            return false
          },

          changeDoneState(status) {
            console.log(status)
            analytics.track('Todo status changed', {
              done: status
            })
          },

          toggleDoneFeature(value) {
            this.state.doneEnabled = value
          }
        }
      }

      const app = Vue.createApp(TodoList)

      app.component('todo-item', {
        props: ['todo', 'doneEnabled'],
        emits: ['doneChanged'],
        template: `
          <li v-if="doneEnabled">
            <input type="checkbox" v-model="todo.isDone" @click="$emit('doneChanged', $event.target.checked)" />
            <label :class="{ done: todo.isDone}">{{ todo.text }}</label>
          </li>
          <li v-if="!doneEnabled">
            {{ todo.text }}
          </li>
        `
      })

      vm = app.mount('#todo-app')
    </script>
    <script>
      try {
        // Instantiate the SDK. CDN will expose splitio globally
        var factory = splitio({
          core: {
            authorizationKey: 'mqoljmh2jr42cesq1ma3ogsa6fc71dj5h6s2',
            // your internal user id, or the account id that
            // the user belongs to.
            // This coudld also be a cookie you generate
            // for anonymous users
            key: 'me',
          }
        });
        // And get the client instance you'll use
        var client = factory.client();
      } catch (error) {
        console.error(error)
      }

      client.on(client.Event.SDK_READY, function() {
        var treatment = client.getTreatment('SPL-TODO_Done');
        if (treatment === 'on') {
            console.log('on')
            vm.toggleDoneFeature(true)
        } else if (treatment === 'off') {
            console.log('off')
            vm.toggleDoneFeature(false)
        } else {
            console.log(treatment)
        }
      })
    </script>
  </body>
</html>